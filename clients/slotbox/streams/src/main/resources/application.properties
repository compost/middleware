# Quarkus Kafka Streams First-Class Citizen Properties
# These are recognized and processed by Quarkus itself
quarkus.kafka-streams.topics=customer_detail
quarkus.kafka-streams.topics-timeout=10s
quarkus.kafka-streams.bootstrap-servers=localhost:9092 

# Kafka Streams Pass-Through Properties
# These use kafka-streams prefix (without 'quarkus') and are passed directly to Kafka Streams
kafka-streams.group.instance.id=main
kafka-streams.replication.factor=3
%dev.kafka-streams.replication.factor=1
%test.kafka-streams.replication.factor=1
kafka-streams.state.dir=/app/state/current 

# RocksDB Configuration for improved durability
kafka-streams.rocksdb.config.setter=io.symplify.streams.RocksDBConfig 

# State Store Cache - Increased from 10KB to 100MB for better performance
# This cache batches writes before flushing to RocksDB, reducing disk I/O
kafka-streams.cache.max.bytes.buffering=104857600 

# Commit interval - Reduced to 100ms for better durability
# More frequent commits = less data loss on failure
kafka-streams.commit.interval.ms=100 

kafka-streams.metadata.max.age.ms=500

# Processing guarantee - Use exactly_once_v2 for better durability
# This ensures transactional state updates with Kafka commits
kafka-streams.processing.guarantee=exactly_once_v2

# Enable state restoration from changelog topics with checkpointing
kafka-streams.num.standby.replicas=1

# Stream threads configuration
kafka-streams.num.stream.threads=8 

# Consumer Configuration
kafka-streams.auto.offset.reset=earliest
kafka-streams.max.poll.records=10000
kafka-streams.max.poll.interval.ms=300000
kafka-streams.fetch.max.wait.ms=500
kafka-streams.fetch.min.bytes=16384
kafka-streams.fetch.max.bytes=52428800
kafka-streams.max.partition.fetch.bytes=1048576

# Graceful Shutdown Configuration
# Allow time for state stores to flush to disk before shutdown
quarkus.shutdown.timeout=60s

# Kafka Streams Task Timeout
# Maximum time a task can stall due to internal errors before raising an error
kafka-streams.task.timeout.ms=300000

# Retry and Backoff Configuration
# Base time to wait before retrying failed requests
kafka-streams.retry.backoff.ms=1000
# Maximum backoff time for reconnection attempts
kafka-streams.reconnect.backoff.max.ms=5000 

# Producer-specific configuration
kafka-streams.producer.retries=10
kafka-streams.producer.retry.backoff.ms=1000
kafka-streams.producer.request.timeout.ms=40000
kafka-streams.producer.delivery.timeout.ms=120000

# State Management & Error Handling
# Deserialization error handling - log and continue
kafka-streams.default.deserialization.exception.handler=org.apache.kafka.streams.errors.LogAndContinueExceptionHandler

# Production error handling - fail fast on production errors
kafka-streams.default.production.exception.handler=org.apache.kafka.streams.errors.DefaultProductionExceptionHandler 

%dev.brand-queue."1"=http://localhost:4566/000000000000/test.fifo
%dev.brand-queue."2"=http://localhost:4566/000000000000/test.fifo
%dev.mapping-selector-dev-prefix=2

%test.brand-queue."1"=http://localhost:4566/000000000000/test.fifo
%test.brand-queue."2"=http://localhost:4566/000000000000/test.fifo
%test.mapping-selector-dev-prefix=2

# SQS
message-group-id=${quarkus.application.name}
quarkus.sqs.aws.credentials.type=default
quarkus.sqs.aws.region=eu-central-1
quarkus.sqs.sync-client.type=aws-crt
quarkus.sqs.async-client.type=aws-crt
quarkus.sqs.sync-client.crt.connection-max-idle-time=60s
quarkus.sqs.sync-client.crt.max-concurrency=100
quarkus.sqs.api-call-timeout=PT2M
quarkus.sqs.async-client.read-timeout=0
quarkus.sqs.async-client.write-timeout=0
quarkus.sqs.async-client.max-concurrency=100
quarkus.sqs.api-call-attempt-timeout=PT60S

%dev.quarkus.sqs.endpoint-override=http://localhost:4566
%dev.quarkus.sqs.aws.credentials.type=static
%dev.quarkus.sqs.aws.credentials.static-provider.access-key-id=test
%dev.quarkus.sqs.aws.credentials.static-provider.secret-access-key=test


%test.quarkus.sqs.endpoint-override=http://localhost:4566
%test.quarkus.sqs.aws.credentials.type=static
%test.quarkus.sqs.aws.credentials.static-provider.access-key-id=test
%test.quarkus.sqs.aws.credentials.static-provider.secret-access-key=test


# CONTAINER
quarkus.container-image.builder=docker
quarkus.docker.buildx.platform=linux/amd64
quarkus.container-image.build=true 
quarkus.container-image.additional-tags=latest
quarkus.container-image.group=${quarkus.application.name}
quarkus.container-image.registry=centralregistry.azurecr.io
quarkus.native.enabled=false
quarkus.ssl.native=true
quarkus.native.container-build=false
quarkus.package.jar.enabled=false
quarkus.native.container-runtime=docker
quarkus.native.additional-build-args=-march=x86-64-v2
quarkus.native.container-runtime-options=--arch=amd64

# LOG
quarkus.log.json.additional-field.serviceName.value=${quarkus.application.name}
quarkus.log.category."io.symplify".level=INFO
quarkus.log.level=WARN
quarkus.log.category."org.eclipse.jetty".level=WARN
quarkus.log.category."org.apache.kafka".level=WARN
quarkus.log.category."kafka.server".level=WARN
quarkus.log.category."io.confluent".level=WARN


# HEALTH
quarkus.smallrye-health.ui.enable=false

# HTTP and DEV
quarkus.devservices.enabled=false
quarkus.http.port=8080
